<script>
  function onChangeCity(event) {
    const selectedCity = event.target.value;

    window.location.href = `/sitene-ekle-iframe?city=${selectedCity}`;
  }

  function onChangeDistrict(event) {
    const selectedCity = document.getElementById('districtsCity').value;
    const selectedDistrict = event.target.value;

    window.location.href = `/sitene-ekle-iframe?city=${selectedCity}&district=${selectedDistrict}`;
  }
</script>

<div class="w-full px-2 py-3 bg-gray-100 text-center rounded-md">
  <h1 class="text-xl font-bold"><%=selectedCity%> <%=selectedDistrict%> Nöbetçi Eczaneler</h1>
  <p class="text-sm text-gray-500">Nöbetçi eczaneler listesi ve bilgileri</p>
</div>

<div class="container flex flex-col items-center justify-center mt-2" style="gap: 0.5rem;">
  <select id="districtsCity" name="districtsCity" class="w-full relative dark:text-white z-10 flex gap-x-3 p-3 bg-white border rounded-lg shadow-lg shadow-gray-100 dark:bg-neutral-900 dark:border-neutral-700 dark:shadow-gray-900/20" onchange="onChangeCity(event)" required>
    <option value="" disabled selected>İl Seç</option>
    <% cities.forEach(city => { %>
    <option value="<%= city %>" <%= (typeof selectedCity !== 'undefined' && selectedCity.toLocaleLowerCase('tr-TR')==city.toLocaleLowerCase('tr-TR')) ? 'selected' : '' %>>
      <%= city[0].toLocaleUpperCase('tr-TR') + city.slice(1).toLocaleLowerCase('tr-TR') %>
    </option>
    <% }); %>
  </select>
  <select id="districtsDistrict" name="districtsDistrict" class="w-full relative dark:text-white z-10 flex gap-x-3 p-3 bg-white border rounded-lg shadow-lg shadow-gray-100 dark:bg-neutral-900 dark:border-neutral-700 dark:shadow-gray-900/20" onchange="onChangeDistrict(event)" required>
    <option value="" disabled selected>İlçe Seç</option>
    <% if(typeof selectableDistricts !== 'undefined' && selectableDistricts && selectableDistricts.length > 0) { %>
    <% selectableDistricts.forEach(district => { %>
    <option value="<%= district %>" <%= (typeof selectedDistrict !== 'undefined' && selectedDistrict.toLocaleLowerCase('tr-TR')==district.toLocaleLowerCase('tr-TR')) ? 'selected' : '' %>>
      <%= district[0].toLocaleUpperCase('tr-TR') + district.slice(1).toLocaleLowerCase('tr-TR') %>
    </option>
    <% }); %>
    <% } %>
  </select>
</div>

<div class="pharmacy-container" style="margin-top: 0.5rem;">
  <% if(typeof pharmacies !== 'undefined' && pharmacies.length > 0) { %>
  <% pharmacies.forEach((pharmacy) => { %>
  <%- include('../../components/pharmacyCard', {pharmacy: pharmacy}) %>
  <% }) %>
  <% } else { %>
  <div class=" container">
    <div class="row">
      <div class="col-md-12">
        <h4>No pharmacies found</h4>
      </div>
    </div>
  </div>
  <% } %>
</div>